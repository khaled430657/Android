          script: |
            echo "Setting up Ngrok..."
            # تأكد من وضع التوكن الصحيح هنا أو عبر Secrets
            ngrok config add-authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
            
            # محاولة تشغيل النفق وحفظ السجل
            echo "Starting Ngrok TCP tunnel..."
            ngrok tcp 5555 --log=stdout > ngrok.log &
            
            # الانتظار قليلاً ليعمل Ngrok
            sleep 5
            
            # ---------------------------------------------------
            # خطوة التشخيص: طباعة محتوى السجل لمعرفة سبب الخطأ
            # ---------------------------------------------------
            echo ">>> NGROK LOGS (Check for errors below):"
            cat ngrok.log
            echo ">>> END OF LOGS"
            
            # محاولة جلب الرابط فقط إذا لم تكن هناك أخطاء قاتلة
            echo "Attempting to extract URL..."
            PUBLIC_URL=$(curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url')
            
            if [ "$PUBLIC_URL" == "null" ] || [ -z "$PUBLIC_URL" ]; then
              echo "❌ FAILED: Could not get public URL. See logs above."
              echo "Common fix: Verify your account on dashboard.ngrok.com/billing/subscription"
            else
              echo "✅ SUCCESS!"
              echo "=========================================="
              echo "Run this command on your PC:"
              echo "adb connect $(echo $PUBLIC_URL | sed 's/tcp:\/\///')"
              echo "=========================================="
            fi
            
            # إبقاء الجلسة مفتوحة فقط إذا نجح الاتصال، أو لفترة قصيرة للفحص
            sleep 600

name: Android on macOS (Fast)
on: workflow_dispatch

jobs:
  run-android:
    runs-on: macos-13
    env:
      # Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙˆÙŠØ³Ø±Ø¹ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¬Ø¯Ø§Ù‹
      HOMEBREW_NO_AUTO_UPDATE: 1
      HOMEBREW_NO_INSTALL_CLEANUP: 1
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install QEMU & Ngrok (Fast Mode)
        run: |
          # Ù†Ø«Ø¨Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          brew install qemu wget
          
          # ØªØ«Ø¨ÙŠØª Ngrok
          wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-darwin-amd64.zip
          unzip -o ngrok-v3-stable-darwin-amd64.zip
          
          # ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†
          ./ngrok config add-authtoken 34jXK13BZ5o7SH6Yu3NCwhQg8L4_5z9UjyKk1FzjWAXA2CmGF

      - name: Download Android
        run: |
          # ØªØ­Ù…ÙŠÙ„ Android 9.0
          wget -O android.iso "https://downloads.sourceforge.net/project/android-x86/Release%209.0/android-x86_64-9.0-r2.iso"

      - name: Start Tunnel & Android
        run: |
          # ØªØ´ØºÙŠÙ„ Ngrok
          ./ngrok tcp 5900 > /dev/null &
          sleep 5
          
          # Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
          echo "=========================================="
          echo "ðŸš€ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØµØ§Ø±ÙˆØ®ÙŠ:"
          curl -s http://localhost:4040/api/tunnels | python3 -c "import sys, json; print(json.load(sys.stdin)['tunnels'][0]['public_url'].replace('tcp://', ''))"
          echo "=========================================="
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (ØªØ³Ø±ÙŠØ¹ Ø¥Ù†ØªÙ„)
          sudo qemu-system-x86_64 \
            -m 6096 \
            -smp 4 \
            -cdrom android.iso \
            -net nic -net user \
            -vnc :0 \
            -boot d \
            -accel hvf \
            -cpu host

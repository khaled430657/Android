name: Android on macOS (Intel)
on: workflow_dispatch

jobs:
  run-android:
    runs-on: macos-13  # ๐ ุงูุชุบููุฑ ููุง: ูุณุชุฎุฏู ูุณุฎุฉ Intel ูุฏุนู ุชุณุฑูุน x86
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install QEMU & Ngrok
        run: |
          brew update
          brew install qemu wget
          # ุชุซุจูุช Ngrok
          wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-darwin-amd64.zip
          unzip ngrok-v3-stable-darwin-amd64.zip
          # ุชูุนูู ุงูุชููู ุงูุฎุงุต ุจู
          ./ngrok config add-authtoken 34jXK13BZ5o7SH6Yu3NCwhQg8L4_5z9UjyKk1FzjWAXA2CmGF

      - name: Download Android
        run: |
          # ุชุญููู Android 9.0 (ุงูุฑุงุจุท ุงููุจุงุดุฑ)
          wget -O android.iso "https://downloads.sourceforge.net/project/android-x86/Release%209.0/android-x86_64-9.0-r2.iso"

      - name: Start Tunnel & Android
        run: |
          # ุชุดุบูู Ngrok ูู ุงูุฎูููุฉ
          ./ngrok tcp 5900 > /dev/null &
          sleep 5
          
          # ุทุจุงุนุฉ ุงูุฑุงุจุท ูููุณุชุฎุฏู ุจูุถูุญ
          echo "=========================================="
          echo "๐ด ุฑุงุจุท ุงูุงุชุตุงู ุจู VNC (ุงูุณุฎ ูุฐุง):"
          curl -s http://localhost:4040/api/tunnels | python3 -c "import sys, json; print(json.load(sys.stdin)['tunnels'][0]['public_url'].replace('tcp://', ''))"
          echo "=========================================="
          
          # ุชุดุบูู ุงูุฃูุฏุฑููุฏ (ูุน ุชุณุฑูุน HVF ุงููุชูุงูู ูุน Intel)
          sudo qemu-system-x86_64 \
            -m 6096 \
            -smp 4 \
            -cdrom android.iso \
            -net nic -net user \
            -vnc :0 \
            -boot d \
            -accel hvf \
            -cpu host
